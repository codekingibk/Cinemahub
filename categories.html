<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Categories - CinemaHub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Space+Grotesk:wght@400..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script
        async
        crossorigin="anonymous"
        data-clerk-publishable-key="pk_test_ZXhjaXRpbmctcGlnbGV0LTIzLmNsZXJrLmFjY291bnRzLmRldiQ"
        src="https://exciting-piglet-23.clerk.accounts.dev/npm/@clerk/clerk-js@5/dist/clerk.browser.js"
        type="text/javascript"
    ></script>
    <style>
        /* Reusing core styles for consistency */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #07070c;
            background-image: radial-gradient(circle at 20% 30%, rgba(45, 20, 80, 0.25) 0%, transparent 40%),
                              radial-gradient(circle at 80% 70%, rgba(90, 30, 120, 0.15) 0%, transparent 45%);
            font-family: 'Space Grotesk', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: #ffffff;
            line-height: 1.5;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 0 2rem; }
        a { text-decoration: none; color: inherit; }
        h1, h2 { font-family: 'Bebas Neue', sans-serif; text-transform: uppercase; letter-spacing: 0.03em; }

        /* Header */
        .site-header {
            padding: 1.5rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.04);
            backdrop-filter: blur(10px);
            background: rgba(7,7,12,0.7);
            position: sticky; top: 0; z-index: 20;
        }
        .nav { display: flex; align-items: center; justify-content: space-between; }
        .brand { display: flex; align-items: center; gap: 0.75rem; font-size: 1.6rem; font-weight: 700; }
        .brand-mark { background: linear-gradient(145deg, #aa5eff, #7c3ced); padding: 0.5rem; border-radius: 8px; color: white; box-shadow: 0 0 12px #9147ff55; }
        .brand-text { font-family: 'Bebas Neue', sans-serif; font-size: 2rem; background: linear-gradient(to right, #ffffff, #e0d0ff); -webkit-background-clip: text; color: transparent; }
        
        .nav-links { display: flex; gap: 2.8rem; font-weight: 500; }
        .nav-links a { color: #c2c2d6; display: flex; align-items: center; gap: 0.5rem; font-size: 1rem; text-transform: uppercase; letter-spacing: 0.15em; border-bottom: 2px solid transparent; padding-bottom: 0.3rem; transition: 0.2s; }
        .nav-links a.active, .nav-links a:hover { color: white; border-bottom-color: #aa5eff; }

        /* Nav Actions */
        .nav-actions { display: flex; gap: 1.5rem; align-items: center; }
        .btn { padding: 0.6rem 1.6rem; border-radius: 40px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1em; cursor: pointer; border: none; }
        .btn.primary { background: linear-gradient(145deg, #9147ff, #7735d8); color: white; box-shadow: 0 10px 20px -5px #5e2ab3; }
        .btn.ghost { background: transparent; color: #ddd; border: 1px solid rgba(255,255,255,0.2); }

        /* Filters Section */
        .filters { padding: 3rem 0 2rem; }
        .filter-bar {
            background: rgba(18, 18, 26, 0.8);
            border: 1px solid rgba(255,255,255,0.08);
            padding: 1.5rem;
            border-radius: 20px;
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group { display: flex; flex-direction: column; gap: 0.5rem; }
        .filter-label { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.1em; color: #9191a8; font-weight: 600; }
        
        select {
            background: #0c0c12;
            color: white;
            border: 1px solid #2a2a3a;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1rem;
            outline: none;
            cursor: pointer;
            min-width: 200px;
        }

        .range-wrap { display: flex; align-items: center; gap: 1rem; }
        input[type=range] { margin-top: 0.5rem; accent-color: #aa5eff; width: 200px; }
        
        .apply-btn {
            margin-left: auto;
            background: #aa5eff;
            color: white;
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .apply-btn:hover { background: #9147ff; }

        /* Grid */
        .results-section { padding: 2rem 0 5rem; }
        .movies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 2rem;
        }
        
        /* Card Reuse */
        .movie-card {
            background: rgba(16, 16, 24, 0.7);
            border-radius: 16px;
            padding: 1rem;
            border: 1px solid rgba(255,255,255,0.04);
            cursor: pointer;
            transition: 0.2s;
        }
        .movie-card:hover { transform: translateY(-5px); border-color: #aa5eff; }
        .movie-poster-container { position: relative; aspect-ratio: 2/3; border-radius: 12px; overflow: hidden; margin-bottom: 1rem; background: #1a1a20; }
        .movie-poster { width: 100%; height: 100%; object-fit: cover; }
        .movie-rating { 
            position: absolute; top: 0.5rem; right: 0.5rem; 
            background: rgba(0,0,0,0.8); padding: 0.2rem 0.6rem; 
            border-radius: 20px; font-size: 0.8rem; font-weight: 700; color: #ffc107; display: flex; align-items: center; gap: 0.3rem; 
        }
        .movie-title { font-size: 1rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .movie-year { font-size: 0.85rem; color: #9191a8; }

        .loading { display: none; justify-content: center; padding: 4rem; }
        .spinner { border: 3px solid rgba(255,255,255,0.1); border-top: 3px solid #aa5eff; border-radius: 50%; width: 40px; height: 40px; animation: spin 0.8s linear infinite; }
        @keyframes spin { 0% {transform: rotate(0deg);} 100% {transform: rotate(360deg);} }

        /* Mobile */
        @media (max-width: 768px) {
            .site-header { position: fixed; bottom: 0; top: auto; width: 100%; height: auto; padding: 0.8rem 0; background: rgba(7,7,12,0.98); border-top: 1px solid rgba(255,255,255,0.1); }
            .nav, .nav-links { flex-direction: row; justify-content: space-around; width: 100%; gap: 0; }
            .brand, .nav-actions { display: none !important; }
            .nav-links a { flex-direction: column; font-size: 0.7rem; color: #9191a8; }
            .nav-links a.active { color: #aa5eff; }
            .nav-links a i { font-size: 1.3rem; margin-bottom: 2px; }
            .nav-links a span { display: block; font-size: 0.65rem; }
            
            body { padding-bottom: 80px; }
            .filter-bar { flex-direction: column; align-items: stretch; gap: 1rem; }
            .apply-btn { width: 100%; margin: 0; }
            
            .movies-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.5rem;
            }
            .movie-card { padding: 0.5rem; background: transparent; border: none; }
            .movie-rating { display: none; }
            .movie-year { display: none; }
            .movie-title { font-size: 0.7rem; text-align: center; }
        }
    </style>
    <style>
        @media (max-width: 420px) {
            .container { max-width: 100% !important; margin: 0 !important; padding: 0 12px !important; }
            .nav-links { gap: 0.6rem !important; }
            h1 { font-size: 1.8rem !important; }
            h2 { font-size: 1.2rem !important; }
            .hero, .hero-grid, .details-layout { grid-template-columns: 1fr !important; gap: 1rem !important; }
        }
    </style>
</head>
<body class="page-categories">
    <header class="site-header">
        <div class="container">
            <nav class="nav">
                <a class="brand" href="index.html">
                    <span class="brand-mark"><i class="fas fa-film"></i></span>
                    <span class="brand-text">CinemaHub</span>
                </a>
                <div class="nav-links">
                    <a href="index.html"><i class="fas fa-house"></i><span>Home</span></a>
                    <a href="#" class="active"><i class="fas fa-layer-group"></i><span>Categories</span></a>
                    <a href="downloads.html"><i class="fas fa-download"></i><span>Downloads</span></a>
                    <a href="profile.html"><i class="fas fa-user"></i><span>Profile</span></a>
                </div>
                <div class="nav-actions">
                    <div id="authButtons">
                        <button onclick="window.location.href='login.html'" class="btn ghost">Log in</button>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="filters">
                <h1>Browse Catalog</h1>
                <p style="color: #9191a8; margin-bottom: 1.5rem;">Filter content by genre and rating.</p>
                
                <div class="filter-bar">
                    <div class="filter-group">
                        <label class="filter-label">Category</label>
                        <select id="catSelect">
                            <option value="Action">Action</option>
                            <option value="Adventure">Adventure</option>
                            <option value="Animation">Animation</option>
                            <option value="Comedy">Comedy</option>
                            <option value="Crime">Crime</option>
                            <option value="Documentary">Documentary</option>
                            <option value="Drama">Drama</option>
                            <option value="Family">Family</option>
                            <option value="Fantasy">Fantasy</option>
                            <option value="History">History</option>
                            <option value="Horror">Horror</option>
                            <option value="Music">Music</option>
                            <option value="Mystery">Mystery</option>
                            <option value="Romance">Romance</option>
                            <option value="Sci-Fi">Sci-Fi</option>
                            <option value="Thriller">Thriller</option>
                            <option value="War">War</option>
                            <option value="Western">Western</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Min Rating: <span id="ratingVal" style="color: white;">0</span>/10</label>
                        <div class="range-wrap">
                            <input type="range" id="ratingRange" min="0" max="10" step="1" value="0">
                        </div>
                    </div>

                    <button class="apply-btn" onclick="applyFilters()">Apply Filters</button>
                </div>
            </div>

            <section class="results-section">
                <div class="loading" id="filterLoading">
                    <div class="spinner"></div>
                </div>
                <div id="catGrid" class="movies-grid"></div>
                <div id="noCatResults" style="display:none; text-align: center; padding: 4rem; color: #666;">
                    <i class="fas fa-search" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                    <p>No titles found matching your criteria.</p>
                </div>
            </section>
        </div>
    </main>

    <!-- Shared scripts -->
    <script src="clerk-auth.js"></script>
    <script src="script.js"></script>
    <script>
        // Page specific logic
        const catSelect = document.getElementById('catSelect');
        const ratingRange = document.getElementById('ratingRange');
        const ratingVal = document.getElementById('ratingVal');
        const catGrid = document.getElementById('catGrid');
        const loader = document.getElementById('filterLoading');
        const noRes = document.getElementById('noCatResults');

        ratingRange.addEventListener('input', (e) => {
            ratingVal.textContent = e.target.value;
        });

        async function applyFilters() {
            const category = catSelect.value;
            const minRating = parseInt(ratingRange.value);

            catGrid.innerHTML = '';
            noRes.style.display = 'none';
            loader.style.display = 'flex';

            try {
                // Fetch by search query using category name
                const response = await fetch(`${API_BASE_URL}/search?q=${category}`);
                const data = await response.json();

                loader.style.display = 'none';

                if(data.success && data.results) {
                    // Client side filter
                    const filtered = data.results.filter(movie => {
                        const r = parseFloat(movie.rating);
                        // If movie has no rating ('N/A'), treat as 0 or exclude? Let's include if minRating is 0
                        const movieRating = isNaN(r) ? 0 : r;
                        return movieRating >= minRating;
                    });

                    if(filtered.length === 0) {
                        noRes.style.display = 'block';
                    } else {
                        filtered.forEach(movie => {
                            // Reuse createMovieCard logic from script.js if possible, 
                            // or simple replicate
                            const card = document.createElement('div');
                            card.className = 'movie-card';
                            card.onclick = () => openDetailsPage(movie); // function from script.js

                            const poster = movie.poster || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'300\' viewBox=\'0 0 200 300\'%3E%3Crect fill=\'%23111\' width=\'200\' height=\'300\'/%3E%3C/svg%3E';
                            
                            card.innerHTML = `
                                <div class="movie-poster-container">
                                    <img src="${poster}" class="movie-poster" loading="lazy">
                                    <div class="movie-rating"><i class="fas fa-star"></i> ${movie.rating}</div>
                                </div>
                                <h3 class="movie-title">${movie.title}</h3>
                                <p class="movie-year">${movie.year || ''}</p>
                            `;
                            catGrid.appendChild(card);
                        });
                    }
                }
            } catch(e) {
                console.error(e);
                loader.style.display = 'none';
                noRes.style.display = 'block';
                noRes.querySelector('p').textContent = 'Error loading content.';
            }
        }

        // Initial Load
        document.addEventListener('DOMContentLoaded', () => {
             // check url params first?
             applyFilters();
        });
    </script>
</body>
</html>